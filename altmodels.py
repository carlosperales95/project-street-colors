images =  Input(shape=(576, 384, 3))
output_1a = Conv2D(64, (3, 3),  padding='same')(images)
output_1b = GroupNormalization()(output_1a)
output_1 = Activation('relu')(output_1b)
output_2a = Conv2D(64, (3, 3),  padding='same')(output_1)
output_2b = GroupNormalization()(output_2a)
output_2 = Activation('relu')(output_2b)
output_3, argmax1 = MaxPoolingWithArgmax2D((2, 2))(output_2)
output_4a = Conv2D(128, (3, 3),  padding='same')(output_3)
output_4b = GroupNormalization()(output_4a)
output_4 = Activation('relu')(output_4b)
output_5a = Conv2D(128, (3, 3),  padding='same')(output_4)
output_5b = GroupNormalization()(output_5a)
output_5 = Activation('relu')(output_5b)
output_6, argmax2 = MaxPoolingWithArgmax2D((2, 2))(output_5)
output_7a = Conv2D(256, (3, 3),  padding='same')(output_6)
output_7b = GroupNormalization()(output_7a)
output_7 = Activation('relu')(output_7b)
output_8a = Conv2D(256, (3, 3),  padding='same')(output_7)
output_8b = GroupNormalization()(output_8a)
output_8 = Activation('relu')(output_8b)
output_9a = Conv2D(256, (3, 3),  padding='same')(output_8)
output_9b = GroupNormalization()(output_9a)
output_9 = Activation('relu')(output_9b)
output_10, argmax3 = MaxPoolingWithArgmax2D((2, 2))(output_9)
output_11a = Conv2D(512, (3, 3),  padding='same')(output_10)
output_11b = GroupNormalization()(output_11a)
output_11 = Activation('relu')(output_11b)
output_12a = Conv2D(512, (3, 3),  padding='same')(output_11)
output_12b = GroupNormalization()(output_12a)
output_12 = Activation('relu')(output_12b)
output_13a = Conv2D(512, (3, 3),  padding='same')(output_12)
output_13b = GroupNormalization()(output_13a)
output_13 = Activation('relu')(output_13b)
output_14, argmax4 = MaxPoolingWithArgmax2D((2, 2))(output_13)
output_15a = Conv2D(512, (3, 3),  padding='same')(output_14)
output_15b = GroupNormalization()(output_15a)
output_15 = Activation('relu')(output_15b)
output_16a = Conv2D(512, (3, 3),  padding='same')(output_15)
output_16b = GroupNormalization()(output_16a)
output_16 = Activation('relu')(output_16b)
output_17a = Conv2D(512, (3, 3),  padding='same')(output_16)
output_17b = GroupNormalization()(output_17a)
output_17 = Activation('relu')(output_17b)
output_18, argmax5 = MaxPoolingWithArgmax2D((2, 2))(output_17)

output_19 = MaxUnpooling2D((2,2))([output_18, argmax5])
output_20a = Conv2D(512, (3, 3),  padding='same')(output_19)
output_20b = GroupNormalization()(output_20a)
output_20 = Activation('relu')(output_20b)
output_21a = Conv2D(512, (3, 3),  padding='same')(output_20)
output_21b = GroupNormalization()(output_21a)
output_21 = Activation('relu')(output_21b)
output_22a = Conv2D(512, (3, 3),  padding='same')(output_21)
output_22b = GroupNormalization()(output_22a)
output_22 = Activation('relu')(output_22b)
output_23 = MaxUnpooling2D((2,2))([output_22, argmax4])
output_24a = Conv2D(512, (3, 3),  padding='same')(output_23)
output_24b = GroupNormalization()(output_24a)
output_24 = Activation('relu')(output_24b)
output_25a = Conv2D(512, (3, 3),  padding='same')(output_24)
output_25b = GroupNormalization()(output_25a)
output_25 = Activation('relu')(output_25b)
output_26a = Conv2D(256, (3, 3),  padding='same')(output_25)
output_26b = GroupNormalization()(output_26a)
output_26 = Activation('relu')(output_26b)
output_27 = MaxUnpooling2D((2,2))([output_26, argmax3])
output_28a = Conv2D(256, (3, 3),  padding='same')(output_27)
output_28b = GroupNormalization()(output_28a)
output_28 = Activation('relu')(output_28b)
output_29a = Conv2D(256, (3, 3),  padding='same')(output_28)
output_29b = GroupNormalization()(output_29a)
output_29 = Activation('relu')(output_29b)
output_30a = Conv2D(128, (3, 3),  padding='same')(output_29)
output_30b = GroupNormalization()(output_30a)
output_30 = Activation('relu')(output_30b)
output_31 = MaxUnpooling2D((2,2))([output_30, argmax2])
output_32a = Conv2D(128, (3, 3),  padding='same')(output_31)
output_32b = GroupNormalization()(output_32a)
output_32 = Activation('relu')(output_32b)
output_33a = Conv2D(64, (3, 3),  padding='same')(output_32)
output_33b = GroupNormalization()(output_33a)
output_33 = Activation('relu')(output_33b)
output_34 = MaxUnpooling2D((2,2))([output_33, argmax1])
output_35a = Conv2D(64, (3, 3),  padding='same')(output_34)
output_35b = GroupNormalization()(output_35a)
output_35 = Activation('relu')(output_35b)
output_36a = Conv2D(66, (3, 3),  padding='same')(output_35)
output_36b = GroupNormalization(groups=33)(output_36a)
predictions = Activation('softmax')(output_36b)

##################################

images =  Input(shape=(img_width, img_height, 3))
output_1a = Conv2D(64, (3, 3),  padding='same')(images)
output_1b = GroupNormalization()(output_1a)
output_1 = Activation('relu')(output_1a)
output_2a = Conv2D(64, (3, 3),  padding='same')(output_1)
output_2b = GroupNormalization()(output_2a)
output_2 = Activation('relu')(output_2a)
output_3, argmax1 = MaxPoolingWithArgmax2D((2, 2))(output_2)
output_4a = Conv2D(128, (3, 3),  padding='same')(output_3)
output_4b = GroupNormalization()(output_4a)
output_4 = Activation('relu')(output_4a)
output_5a = Conv2D(128, (3, 3),  padding='same')(output_4)
output_5b = GroupNormalization()(output_5a)
output_5 = Activation('relu')(output_5a)
output_6, argmax2 = MaxPoolingWithArgmax2D((2, 2))(output_5)
output_7a = Conv2D(256, (3, 3),  padding='same')(output_6)
output_7b = GroupNormalization()(output_7a)
output_7 = Activation('relu')(output_7a)
output_8a = Conv2D(256, (3, 3),  padding='same')(output_7)
output_8b = GroupNormalization()(output_8a)
output_8 = Activation('relu')(output_8a)
output_9a = Conv2D(256, (3, 3),  padding='same')(output_8)
output_9b = GroupNormalization()(output_9a)
output_9 = Activation('relu')(output_9a)
output_10, argmax3 = MaxPoolingWithArgmax2D((2, 2))(output_9)
output_11a = Conv2D(512, (3, 3),  padding='same')(output_10)
output_11b = GroupNormalization()(output_11a)
output_11 = Activation('relu')(output_11a)
output_12a = Conv2D(512, (3, 3),  padding='same')(output_11)
output_12b = GroupNormalization()(output_12a)
output_12 = Activation('relu')(output_12a)
output_13a = Conv2D(512, (3, 3),  padding='same')(output_12)
output_13b = GroupNormalization()(output_13a)
output_13 = Activation('relu')(output_13a)
output_14, argmax4 = MaxPoolingWithArgmax2D((2, 2))(output_13)
output_15a = Conv2D(512, (3, 3),  padding='same')(output_14)
output_15b = GroupNormalization()(output_15a)
output_15 = Activation('relu')(output_15a)
output_16a = Conv2D(512, (3, 3),  padding='same')(output_15)
output_16b = GroupNormalization()(output_16a)
output_16 = Activation('relu')(output_16a)
output_17a = Conv2D(512, (3, 3),  padding='same')(output_16)
output_17b = GroupNormalization()(output_17a)
output_17 = Activation('relu')(output_17a)
output_18, argmax5 = MaxPoolingWithArgmax2D((2, 2))(output_17)

output_19 = MaxUnpooling2D((2,2))([output_18, argmax5])
output_20a = Conv2D(512, (3, 3),  padding='same')(output_19)
output_20b = GroupNormalization()(output_20a)
output_20 = Activation('relu')(output_20a)
output_21a = Conv2D(512, (3, 3),  padding='same')(output_20)
output_21b = GroupNormalization()(output_21a)
output_21 = Activation('relu')(output_21a)
output_22a = Conv2D(512, (3, 3),  padding='same')(output_21)
output_22b = GroupNormalization()(output_22a)
output_22 = Activation('relu')(output_22a)
output_23 = MaxUnpooling2D((2,2))([output_22, argmax4])
output_24a = Conv2D(512, (3, 3),  padding='same')(output_23)
output_24b = GroupNormalization()(output_24a)
output_24 = Activation('relu')(output_24a)
output_25a = Conv2D(512, (3, 3),  padding='same')(output_24)
output_25b = GroupNormalization()(output_25a)
output_25 = Activation('relu')(output_25a)
output_26a = Conv2D(256, (3, 3),  padding='same')(output_25)
output_26b = GroupNormalization()(output_26a)
output_26 = Activation('relu')(output_26a)
output_27 = MaxUnpooling2D((2,2))([output_26, argmax3])
output_28a = Conv2D(256, (3, 3),  padding='same')(output_27)
output_28b = GroupNormalization()(output_28a)
output_28 = Activation('relu')(output_28a)
output_29a = Conv2D(256, (3, 3),  padding='same')(output_28)
output_29b = GroupNormalization()(output_29a)
output_29 = Activation('relu')(output_29a)
output_30a = Conv2D(128, (3, 3),  padding='same')(output_29)
output_30b = GroupNormalization()(output_30a)
output_30 = Activation('relu')(output_30a)
output_31 = MaxUnpooling2D((2,2))([output_30, argmax2])
output_32a = Conv2D(128, (3, 3),  padding='same')(output_31)
output_32b = GroupNormalization()(output_32a)
output_32 = Activation('relu')(output_32a)
output_33a = Conv2D(64, (3, 3),  padding='same')(output_32)
output_33b = GroupNormalization()(output_33a)
output_33 = Activation('relu')(output_33a)
output_34 = MaxUnpooling2D((2,2))([output_33, argmax1])
output_35a = Conv2D(64, (3, 3),  padding='same')(output_34)
output_35b = GroupNormalization()(output_35a)
output_35 = Activation('relu')(output_35a)
output_36a = Conv2D(66, (3, 3),  padding='same')(output_35)
output_36b = GroupNormalization(groups=33)(output_36a)
predictions = Activation('softmax')(output_36a)

##########################################################

images =  Input(shape=(img_width, img_height, 3))
output_1a = Conv2D(64, (3, 3),  padding='same')(images)
output_1b = InstanceNormalization()(output_1a)
output_1 = Activation('relu')(output_1b)
output_2a = Conv2D(64, (3, 3),  padding='same')(output_1)
output_2b = InstanceNormalization()(output_2a)
output_2 = Activation('relu')(output_2b)
output_3, argmax1 = MaxPoolingWithArgmax2D((2, 2))(output_2)
output_4a = Conv2D(128, (3, 3),  padding='same')(output_3)
output_4b = InstanceNormalization()(output_4a)
output_4 = Activation('relu')(output_4b)
output_5a = Conv2D(128, (3, 3),  padding='same')(output_4)
output_5b = InstanceNormalization()(output_5a)
output_5 = Activation('relu')(output_5b)
output_6, argmax2 = MaxPoolingWithArgmax2D((2, 2))(output_5)
output_7a = Conv2D(256, (3, 3),  padding='same')(output_6)
output_7b = InstanceNormalization()(output_7a)
output_7 = Activation('relu')(output_7b)
output_8a = Conv2D(256, (3, 3),  padding='same')(output_7)
output_8b = InstanceNormalization()(output_8a)
output_8 = Activation('relu')(output_8b)
output_9a = Conv2D(256, (3, 3),  padding='same')(output_8)
output_9b = InstanceNormalization()(output_9a)
output_9 = Activation('relu')(output_9b)
output_10, argmax3 = MaxPoolingWithArgmax2D((2, 2))(output_9)
output_11a = Conv2D(512, (3, 3),  padding='same')(output_10)
output_11b = InstanceNormalization()(output_11a)
output_11 = Activation('relu')(output_11b)
output_12a = Conv2D(512, (3, 3),  padding='same')(output_11)
output_12b = InstanceNormalization()(output_12a)
output_12 = Activation('relu')(output_12b)
output_13a = Conv2D(512, (3, 3),  padding='same')(output_12)
output_13b = InstanceNormalization()(output_13a)
output_13 = Activation('relu')(output_13b)
output_14, argmax4 = MaxPoolingWithArgmax2D((2, 2))(output_13)
output_15a = Conv2D(512, (3, 3),  padding='same')(output_14)
output_15b = InstanceNormalization()(output_15a)
output_15 = Activation('relu')(output_15b)
output_16a = Conv2D(512, (3, 3),  padding='same')(output_15)
output_16b = InstanceNormalization()(output_16a)
output_16 = Activation('relu')(output_16b)
output_17a = Conv2D(512, (3, 3),  padding='same')(output_16)
output_17b = InstanceNormalization()(output_17a)
output_17 = Activation('relu')(output_17b)
output_18, argmax5 = MaxPoolingWithArgmax2D((2, 2))(output_17)

output_19 = MaxUnpooling2D((2,2))([output_18, argmax5])
output_20a = Conv2D(512, (3, 3),  padding='same')(output_19)
output_20b = InstanceNormalization()(output_20a)
output_20 = Activation('relu')(output_20b)
output_21a = Conv2D(512, (3, 3),  padding='same')(output_20)
output_21b = InstanceNormalization()(output_21a)
output_21 = Activation('relu')(output_21b)
output_22a = Conv2D(512, (3, 3),  padding='same')(output_21)
output_22b = InstanceNormalization()(output_22a)
output_22 = Activation('relu')(output_22b)
output_23 = MaxUnpooling2D((2,2))([output_22, argmax4])
output_24a = Conv2D(512, (3, 3),  padding='same')(output_23)
output_24b = InstanceNormalization()(output_24a)
output_24 = Activation('relu')(output_24b)
output_25a = Conv2D(512, (3, 3),  padding='same')(output_24)
output_25b = InstanceNormalization()(output_25a)
output_25 = Activation('relu')(output_25b)
output_26a = Conv2D(256, (3, 3),  padding='same')(output_25)
output_26b = InstanceNormalization()(output_26a)
output_26 = Activation('relu')(output_26b)
output_27 = MaxUnpooling2D((2,2))([output_26, argmax3])
output_28a = Conv2D(256, (3, 3),  padding='same')(output_27)
output_28b = InstanceNormalization()(output_28a)
output_28 = Activation('relu')(output_28b)
output_29a = Conv2D(256, (3, 3),  padding='same')(output_28)
output_29b = InstanceNormalization()(output_29a)
output_29 = Activation('relu')(output_29b)
output_30a = Conv2D(128, (3, 3),  padding='same')(output_29)
output_30b = InstanceNormalization()(output_30a)
output_30 = Activation('relu')(output_30b)
output_31 = MaxUnpooling2D((2,2))([output_30, argmax2])
output_32a = Conv2D(128, (3, 3),  padding='same')(output_31)
output_32b = InstanceNormalization()(output_32a)
output_32 = Activation('relu')(output_32b)
output_33a = Conv2D(64, (3, 3),  padding='same')(output_32)
output_33b = InstanceNormalization()(output_33a)
output_33 = Activation('relu')(output_33b)
output_34 = MaxUnpooling2D((2,2))([output_33, argmax1])
output_35a = Conv2D(64, (3, 3),  padding='same')(output_34)
output_35b = InstanceNormalization()(output_35a)
output_35 = Activation('relu')(output_35b)
output_36a = Conv2D(66, (1, 1),  padding='same')(output_35)
output_36b = InstanceNormalization()(output_36a)
predictions = Activation('softmax')(output_36a)

########################################################
images =  Input(shape=(img_width, img_height, 3))
output_1a = Conv2D(64, (3, 3),  padding='same')(images)
output_1b = BatchNormalization()(output_1a)
output_1 = Activation('relu')(output_1a)
output_2a = Conv2D(64, (3, 3),  padding='same')(output_1)
output_2b = BatchNormalization()(output_2a)
output_2 = Activation('relu')(output_2a)
output_3, argmax1 = MaxPoolingWithArgmax2D(output_2,ksize=(1, 2,2,1),strides=[1,1,1,1],padding='SAME')
output_4a = Conv2D(128, (3, 3),  padding='same')(output_3)
output_4b = BatchNormalization()(output_4a)
output_4 = Activation('relu')(output_4a)
output_5a = Conv2D(128, (3, 3),  padding='same')(output_4)
output_5b = BatchNormalization()(output_5a)
output_5 = Activation('relu')(output_5a)
output_6, argmax2 = MaxPoolingWithArgmax2D(output_5,ksize=(1, 2,2,1),strides=[1,1,1,1],padding='SAME')
output_7a = Conv2D(256, (3, 3),  padding='same')(output_6)
output_7b = BatchNormalization()(output_7a)
output_7 = Activation('relu')(output_7a)
output_8a = Conv2D(256, (3, 3),  padding='same')(output_7)
output_8b = BatchNormalization()(output_8a)
output_8 = Activation('relu')(output_8a)
output_9a = Conv2D(256, (3, 3),  padding='same')(output_8)
output_9b = BatchNormalization()(output_9a)
output_9 = Activation('relu')(output_9a)
output_10, argmax3 = MaxPoolingWithArgmax2D(output_9,ksize=(1, 2,2,1),strides=[1,1,1,1],padding='SAME')
output_11a = Conv2D(512, (3, 3),  padding='same')(output_10)
output_11b = BatchNormalization()(output_11a)
output_11 = Activation('relu')(output_11a)
output_12a = Conv2D(512, (3, 3),  padding='same')(output_11)
output_12b = BatchNormalization()(output_12a)
output_12 = Activation('relu')(output_12a)
output_13a = Conv2D(512, (3, 3),  padding='same')(output_12)
output_13b = BatchNormalization()(output_13a)
output_13 = Activation('relu')(output_13a)
output_14, argmax4 = MaxPoolingWithArgmax2D(output_13,ksize=(1, 2,2,1),strides=[1,1,1,1],padding='SAME')
output_15a = Conv2D(512, (3, 3),  padding='same')(output_14)
output_15b = BatchNormalization()(output_15a)
output_15 = Activation('relu')(output_15a)
output_16a = Conv2D(512, (3, 3),  padding='same')(output_15)
output_16b = BatchNormalization()(output_16a)
output_16 = Activation('relu')(output_16a)
output_17a = Conv2D(512, (3, 3),  padding='same')(output_16)
output_17b = BatchNormalization()(output_17a)
output_17 = Activation('relu')(output_17a)
output_18, argmax5 = MaxPoolingWithArgmax2D(output_17,ksize=(1, 2,2,1),strides=[1,1,1,1],padding='SAME')

output_19 = MaxUnpooling2D(output_18, argmax5)
output_20a = Conv2D(512, (3, 3),  padding='same')(output_19)
output_20b = BatchNormalization()(output_20a)
output_20 = Activation('relu')(output_20a)
output_21a = Conv2D(512, (3, 3),  padding='same')(output_20)
output_21b = BatchNormalization()(output_21a)
output_21 = Activation('relu')(output_21a)
output_22a = Conv2D(512, (3, 3),  padding='same')(output_21)
output_22b = BatchNormalization()(output_22a)
output_22 = Activation('relu')(output_22a)
output_23 = MaxUnpooling2D(output_22, argmax4, scope='kek')
output_24a = Conv2D(512, (3, 3),  padding='same')(output_23)
output_24b = BatchNormalization()(output_24a)
output_24 = Activation('relu')(output_24a)
output_25a = Conv2D(512, (3, 3),  padding='same')(output_24)
output_25b = BatchNormalization()(output_25a)
output_25 = Activation('relu')(output_25a)
output_26a = Conv2D(256, (3, 3),  padding='same')(output_25)
output_26b = BatchNormalization()(output_26a)
output_26 = Activation('relu')(output_26a)
output_27 = MaxUnpooling2D(output_26, argmax3,scope='lel')
output_28a = Conv2D(256, (3, 3),  padding='same')(output_27)
output_28b = BatchNormalization()(output_28a)
output_28 = Activation('relu')(output_28a)
output_29a = Conv2D(256, (3, 3),  padding='same')(output_28)
output_29b = BatchNormalization()(output_29a)
output_29 = Activation('relu')(output_29a)
output_30a = Conv2D(128, (3, 3),  padding='same')(output_29)
output_30b = BatchNormalization()(output_30a)
output_30 = Activation('relu')(output_30a)
output_31 = MaxUnpooling2D(output_30, argmax2,scope='wtf')
output_32a = Conv2D(128, (3, 3),  padding='same')(output_31)
output_32b = BatchNormalization()(output_32a)
output_32 = Activation('relu')(output_32a)
output_33a = Conv2D(64, (3, 3),  padding='same')(output_32)
output_33b = BatchNormalization()(output_33a)
output_33 = Activation('relu')(output_33a)
output_34 = MaxUnpooling2D(output_33, argmax1,scope='srsly')
output_35a = Conv2D(64, (3, 3),  padding='same')(output_34)
output_35b = BatchNormalization()(output_35a)
output_35 = Activation('relu')(output_35a)
output_36a = Conv2D(66, (3, 3),  padding='same')(output_35)
output_36b = BatchNormalization()(output_36a)
predictions = Activation('softmax')(output_36a)

################################################

images =  Input(shape=(img_width, img_height, 3))
output_1a = Conv2D(64, (3, 3),  padding='same')(images)
output_1 = Activation('relu')(output_1a)
output_2a = Conv2D(64, (3, 3),  padding='same')(output_1)
output_2 = Activation('relu')(output_2a)
output_3, argmax1 = MaxPoolingWithArgmax2D(output_2,ksize=(1, 2,2,1),strides=[1,2,2,1],padding='SAME')
output_4a = Conv2D(128, (3, 3),  padding='same')(output_3)
output_4 = Activation('relu')(output_4a)
output_5a = Conv2D(128, (3, 3),  padding='same')(output_4)
output_5 = Activation('relu')(output_5a)
output_6, argmax2 = MaxPoolingWithArgmax2D(output_5,ksize=(1, 2,2,1),strides=[1,2,2,1],padding='SAME')
output_7a = Conv2D(256, (3, 3),  padding='same')(output_6)
output_7 = Activation('relu')(output_7a)
output_8a = Conv2D(256, (3, 3),  padding='same')(output_7)
output_8 = Activation('relu')(output_8a)
output_9a = Conv2D(256, (3, 3),  padding='same')(output_8)
output_9 = Activation('relu')(output_9a)
output_10, argmax3 = MaxPoolingWithArgmax2D(output_9,ksize=(1, 2,2,1),strides=[1,2,2,1],padding='SAME')
output_11a = Conv2D(512, (3, 3),  padding='same')(output_10)
output_11 = Activation('relu')(output_11a)
output_12a = Conv2D(512, (3, 3),  padding='same')(output_11)
output_12 = Activation('relu')(output_12a)
output_13a = Conv2D(512, (3, 3),  padding='same')(output_12)
output_13 = Activation('relu')(output_13a)
output_14, argmax4 = MaxPoolingWithArgmax2D(output_13,ksize=(1, 2,2,1),strides=[1,2,2,1],padding='SAME')
output_15a = Conv2D(512, (3, 3),  padding='same')(output_14)
output_15 = Activation('relu')(output_15a)
output_16a = Conv2D(512, (3, 3),  padding='same')(output_15)
output_16 = Activation('relu')(output_16a)
output_17a = Conv2D(512, (3, 3),  padding='same')(output_16)
output_17 = Activation('relu')(output_17a)
output_18, argmax5 = MaxPoolingWithArgmax2D(output_17,ksize=(1, 2,2,1),strides=[1,2,2,1],padding='SAME')

output_19 = MaxUnpooling2D(output_18, argmax5)
output_20a = Conv2D(512, (3, 3),  padding='same')(output_19)
output_20 = Activation('relu')(output_20a)
output_21a = Conv2D(512, (3, 3),  padding='same')(output_20)
output_21 = Activation('relu')(output_21a)
output_22a = Conv2D(512, (3, 3),  padding='same')(output_21)
output_22 = Activation('relu')(output_22a)
output_23 = MaxUnpooling2D(output_22, argmax4)
output_24a = Conv2D(512, (3, 3),  padding='same')(output_23)
output_24 = Activation('relu')(output_24a)
output_25a = Conv2D(512, (3, 3),  padding='same')(output_24)
output_25 = Activation('relu')(output_25a)
output_26a = Conv2D(256, (3, 3),  padding='same')(output_25)
output_26 = Activation('relu')(output_26a)
output_27 = MaxUnpooling2D(output_26, argmax3)
output_28a = Conv2D(256, (3, 3),  padding='same')(output_27)
output_28 = Activation('relu')(output_28a)
output_29a = Conv2D(256, (3, 3),  padding='same')(output_28)
output_29 = Activation('relu')(output_29a)
output_30a = Conv2D(128, (3, 3),  padding='same')(output_29)
output_30 = Activation('relu')(output_30a)
output_31 = MaxUnpooling2D(output_30, argmax2)
output_32a = Conv2D(128, (3, 3),  padding='same')(output_31)
output_32 = Activation('relu')(output_32a)
output_33a = Conv2D(64, (3, 3),  padding='same')(output_32)
output_33 = Activation('relu')(output_33a)
output_34 = MaxUnpooling2D(output_33, argmax1)
output_35a = Conv2D(64, (3, 3),  padding='same')(output_34)
output_35 = Activation('relu')(output_35a)
output_36a = Conv2D(66, (3, 3),  padding='same')(output_35)
predictions = Activation('softmax')(output_36a)

############################### Segnet wo 2 poolings
images =  Input(shape=(img_width, img_height, 3))
output_1a = Conv2D(64, (3, 3),  padding='same')(images)
output_1 = Activation('relu')(output_1a)
output_2a = Conv2D(64, (3, 3),  padding='same')(output_1)
output_2 = Activation('relu')(output_2a)
output_3, argmax1 = MaxPoolingWithArgmax2D(output_2,ksize=(1, 2,2,1),strides=[1,2,2,1],padding='SAME')
output_4a = Conv2D(128, (3, 3),  padding='same')(output_3)
output_4 = Activation('relu')(output_4a)
output_5a = Conv2D(128, (3, 3),  padding='same')(output_4)
output_5 = Activation('relu')(output_5a)
output_6, argmax2 = MaxPoolingWithArgmax2D(output_5,ksize=(1, 2,2,1),strides=[1,2,2,1],padding='SAME')
output_7a = Conv2D(256, (3, 3),  padding='same')(output_6)
output_7 = Activation('relu')(output_7a)
output_8a = Conv2D(256, (3, 3),  padding='same')(output_7)
output_8 = Activation('relu')(output_8a)
output_9a = Conv2D(256, (3, 3),  padding='same')(output_8)
output_9 = Activation('relu')(output_9a)
output_10, argmax3 = MaxPoolingWithArgmax2D(output_9,ksize=(1, 2,2,1),strides=[1,2,2,1],padding='SAME')

output_27 = MaxUnpooling2D(output_10, argmax3)
output_28a = Conv2D(256, (3, 3),  padding='same')(output_27)
output_28 = Activation('relu')(output_28a)
output_29a = Conv2D(256, (3, 3),  padding='same')(output_28)
output_29 = Activation('relu')(output_29a)
output_30a = Conv2D(128, (3, 3),  padding='same')(output_29)
output_30 = Activation('relu')(output_30a)
output_31 = MaxUnpooling2D(output_30, argmax2)
output_32a = Conv2D(128, (3, 3),  padding='same')(output_31)
output_32 = Activation('relu')(output_32a)
output_33a = Conv2D(64, (3, 3),  padding='same')(output_32)
output_33 = Activation('relu')(output_33a)
output_34 = MaxUnpooling2D(output_33, argmax1)
output_35a = Conv2D(64, (3, 3),  padding='same')(output_34)
output_35 = Activation('relu')(output_35a)
output_36a = Conv2D(66, (3, 3),  padding='same')(output_35)
predictions = Activation('softmax')(output_36a)

#################################### XCEPTION A

l000 =  Input(shape=(img_width, img_height, 3))

#block1
l011 = Conv2D(32,(3,3),strides=2, padding='same', name='block1')(l000)
l012 = InstanceNormalization()(l011)
l010 = Activation('relu')(l012)

l021 = Conv2D(64,(3,3),padding='same')(l010)
l022 = InstanceNormalization()(l021)
l020 = Activation('relu')(l022)

l031 = Conv2D(128,(1,1), strides=2,name='resid1')(l020)
l030 = InstanceNormalization()(l031)

#block2
l041 = SeparableConv2D(128,(3,3),padding='same',name='block2')(l020)
l042 = InstanceNormalization()(l041)
l040 = Activation('relu')(l042)

l051 = SeparableConv2D(128,(3,3),padding='same')(l040)
l052 = InstanceNormalization()(l051)
l053 = MaxPooling2D((3,3),strides=2,padding='same')(l052)
l050 = Add()([l030,l053])

l061 = Conv2D(256,(1,1), strides=2,name='resid2')(l050)
l060 = InstanceNormalization()(l061)

#block3
l071 = Activation('relu',name='block3')(l050)
l072 = SeparableConv2D(256,(3,3),padding='same')(l071)
l073 = InstanceNormalization()(l072)
l070 = Activation('relu')(l073)

l081 = SeparableConv2D(256,(3,3),padding='same')(l070)
l082 = InstanceNormalization()(l081)
l083 = MaxPooling2D((3,3),strides=2,padding='same')(l082)
l080 = Add()([l060,l083])

l091 = Conv2D(728,(1,1), strides=2,name='resid3')(l080)
l090 = InstanceNormalization()(l091)

#block4
l101 = Activation('relu',name='block4')(l080)
l102 = SeparableConv2D(728,(3,3),padding='same')(l101)
l103 = InstanceNormalization()(l102)
l100 = Activation('relu')(l103)

l111 = SeparableConv2D(728,(3,3),padding='same')(l100)
l112 = InstanceNormalization()(l111)
l113 = MaxPooling2D((3,3),strides=2,padding='same')(l112)
l110 = Add()([l090,l113])

#middleflow
l121 = Activation('relu')(l110)
l122 = SeparableConv2D(728,(3,3),padding='same')(l121)
l123 = InstanceNormalization()(l122)
l124 = Activation('relu')(l123)
l125 = SeparableConv2D(728,(3,3),padding='same')(l124)
l126 = InstanceNormalization()(l125)
l127 = Activation('relu')(l126)
l128 = SeparableConv2D(728,(3,3),padding='same')(l127)
l129 = InstanceNormalization()(l128)
l120 = Activation('relu')(l129)
l12 = Add()([l110,l120])

l131 = Activation('relu')(l12)
l132 = SeparableConv2D(728,(3,3),padding='same')(l131)
l133 = InstanceNormalization()(l132)
l134 = Activation('relu')(l133)
l135 = SeparableConv2D(728,(3,3),padding='same')(l134)
l136 = InstanceNormalization()(l135)
l137 = Activation('relu')(l136)
l138 = SeparableConv2D(728,(3,3),padding='same')(l137)
l139 = InstanceNormalization()(l138)
l130 = Activation('relu')(l139)
l13 = Add()([l12,l130])

l141 = Activation('relu')(l13)
l142 = SeparableConv2D(728,(3,3),padding='same')(l141)
l143 = InstanceNormalization()(l142)
l144 = Activation('relu')(l143)
l145 = SeparableConv2D(728,(3,3),padding='same')(l144)
l146 = InstanceNormalization()(l145)
l147 = Activation('relu')(l146)
l148 = SeparableConv2D(728,(3,3),padding='same')(l147)
l149 = InstanceNormalization()(l148)
l140 = Activation('relu')(l149)
l14 = Add()([l13,l140])

l151 = Activation('relu')(l14)
l152 = SeparableConv2D(728,(3,3),padding='same')(l151)
l153 = InstanceNormalization()(l152)
l154 = Activation('relu')(l153)
l155 = SeparableConv2D(728,(3,3),padding='same')(l154)
l156 = InstanceNormalization()(l155)
l157 = Activation('relu')(l156)
l158 = SeparableConv2D(728,(3,3),padding='same')(l157)
l159 = InstanceNormalization()(l158)
l150 = Activation('relu')(l159)
l15 = Add()([l14,l150])

l161 = Activation('relu')(l15)
l162 = SeparableConv2D(728,(3,3),padding='same')(l161)
l163 = InstanceNormalization()(l162)
l164 = Activation('relu')(l163)
l165 = SeparableConv2D(728,(3,3),padding='same')(l164)
l166 = InstanceNormalization()(l165)
l167 = Activation('relu')(l166)
l168 = SeparableConv2D(728,(3,3),padding='same')(l167)
l169 = InstanceNormalization()(l168)
l160 = Activation('relu')(l169)
l16 = Add()([l15,l160])

l171 = Activation('relu')(l16)
l172 = SeparableConv2D(728,(3,3),padding='same')(l171)
l173 = InstanceNormalization()(l172)
l174 = Activation('relu')(l173)
l175 = SeparableConv2D(728,(3,3),padding='same')(l174)
l176 = InstanceNormalization()(l175)
l177 = Activation('relu')(l176)
l178 = SeparableConv2D(728,(3,3),padding='same')(l177)
l179 = InstanceNormalization()(l178)
l170 = Activation('relu')(l179)
l17 = Add()([l16,l170])

l181 = Activation('relu')(l17)
l182 = SeparableConv2D(728,(3,3),padding='same')(l181)
l183 = InstanceNormalization()(l182)
l184 = Activation('relu')(l183)
l185 = SeparableConv2D(728,(3,3),padding='same')(l184)
l186 = InstanceNormalization()(l185)
l187 = Activation('relu')(l186)
l188 = SeparableConv2D(728,(3,3),padding='same')(l187)
l189 = InstanceNormalization()(l188)
l180 = Activation('relu')(l189)
l18 = Add()([l17,l180])

l191 = Activation('relu')(l18)
l192 = SeparableConv2D(728,(3,3),padding='same')(l191)
l193 = InstanceNormalization()(l192)
l194 = Activation('relu')(l193)
l195 = SeparableConv2D(728,(3,3),padding='same')(l194)
l196 = InstanceNormalization()(l195)
l197 = Activation('relu')(l196)
l198 = SeparableConv2D(728,(3,3),padding='same')(l197)
l199 = InstanceNormalization()(l198)
l190 = Activation('relu')(l199)
l19 = Add()([l18,l190])

#exitflow
#l201 = Conv2D(1024,(1,1), strides=2)(l19)
l201 = Conv2D(1024,(1,1),padding='same')(l19)
l200 = InstanceNormalization()(l201)

l211 = Activation('relu')(l19)
l212 = SeparableConv2D(728,(3,3),padding='same')(l211)
l213 = InstanceNormalization()(l212)
l210 = Activation('relu')(l213)

l221 = SeparableConv2D(1024,(3,3),padding='same')(l210)
l222 = InstanceNormalization()(l221)
#l223 = MaxPooling2D((3,3),strides=2,padding='same')(l222)
l220 = Add()([l200,l222])

l231 = SeparableConv2D(1536,(3,3),padding='same')(l220)
l232 = InstanceNormalization()(l231)
l230 = Activation('relu')(l232)

l241 = SeparableConv2D(2048,(3,3),padding='same')(l230)
l242 = InstanceNormalization()(l241)
l240 = Activation('relu')(l242)

#l251 = AvgPool2D((10,10))(l240)
#l252 = Dense(39)(l251)
#l250 = InstanceNormalization()(l252)

#deconvolution
d001 = Conv2D(1024,(1,1),padding='same')(l222)
d002 = InstanceNormalization()(d001)
d003 = Activation('relu')(d002)
d004 = Conv2DTranspose(1024,kernel_size=(2,2), strides=(2,2), padding='same')(l240)
d005 = InstanceNormalization()(d004)
d006 = Activation('relu')(d005)
#d000 = Add()([d006,d003])

d011 = Conv2D(728,(1,1),padding='same')(l112)
d012 = InstanceNormalization()(d011)
d013 = Activation('relu')(d012)
d014 = Conv2DTranspose(728,kernel_size=(2,2), strides=(2,2), padding='same')(l240)
d015 = InstanceNormalization()(d014)
d016 = Activation('relu')(d015)
d010 = Add()([d016,d013])

d021 = Conv2D(256,(1,1),padding='same')(l082)
d022 = InstanceNormalization()(d021)
d023 = Activation('relu')(d022)
d024 = Conv2DTranspose(256,kernel_size=(2,2), strides=(2,2), padding='same')(d010)
d025 = InstanceNormalization()(d024)
d026 = Activation('relu')(d025)
d020 = Add()([d026,d023])

d031 = Conv2D(128,(1,1),padding='same')(l052)
d032 = InstanceNormalization()(d031)
d033 = Activation('relu')(d032)
d034 = Conv2DTranspose(128,kernel_size=(2,2), strides=(2,2), padding='same')(d020)
d035 = InstanceNormalization()(d034)
d036 = Activation('relu')(d035)
d030 = Add()([d036,d033])

d041 = Conv2D(64,(1,1),padding='same')(l000)
d042 = InstanceNormalization()(d041)
d043 = Activation('relu')(d042)
d044 = Conv2DTranspose(64,kernel_size=(2,2), strides=(2,2), padding='same')(d030)
d045 = InstanceNormalization()(d044)
d046 = Activation('relu')(d045)
d040 = Add()([d046,d043])

#l999 = Activation('softmax')(l251)
d997 = Conv2D(39,(1,1),padding='same')(d040)
d998 = InstanceNormalization()(d997)
d999 = Activation('softmax')(d998)

#######################################à XCP

l000 = Input(shape=(img_width, img_height, 3))
l001 = Conv2D(32,(3,3),strides=1, padding='same')(l000)
l002 = InstanceNormalization()(l001)
l003 = Activation('relu')(l002)

#block1
l011 = Conv2D(32,(3,3),strides=2, padding='same')(l000)
l012 = InstanceNormalization()(l011)
l010 = Activation('relu')(l012)

l021 = Conv2D(64,(3,3),padding='same')(l010)
l022 = InstanceNormalization()(l021)
l020 = Activation('relu')(l022)

l031 = Conv2D(128,(1,1), strides=2,name='resid1')(l020)
l030 = InstanceNormalization()(l031)

#block2
l041 = SeparableConv2D(128,(3,3),padding='same',name='block2')(l020)
l042 = InstanceNormalization()(l041)
l040 = Activation('relu')(l042)

l051 = SeparableConv2D(128,(3,3),padding='same')(l040)
l052 = InstanceNormalization()(l051)
l053 = MaxPooling2D((3,3),strides=2,padding='same')(l052)
l050 = Add()([l030,l053])

l061 = Conv2D(256,(1,1), strides=2,name='resid2')(l050)
l060 = InstanceNormalization()(l061)

#block3
l071 = Activation('relu',name='block3')(l050)
l072 = SeparableConv2D(256,(3,3),padding='same')(l071)
l073 = InstanceNormalization()(l072)
l070 = Activation('relu')(l073)

l081 = SeparableConv2D(256,(3,3),padding='same')(l070)
l082 = InstanceNormalization()(l081)
l083 = MaxPooling2D((3,3),strides=2,padding='same')(l082)
l080 = Add()([l060,l083])

l091 = Conv2D(728,(1,1), strides=2,name='resid3')(l080)
l090 = InstanceNormalization()(l091)

#block4
l101 = Activation('relu',name='block4')(l080)
l102 = SeparableConv2D(728,(3,3),padding='same')(l101)
l103 = InstanceNormalization()(l102)
l100 = Activation('relu')(l103)

l111 = SeparableConv2D(728,(3,3),padding='same')(l100)
l112 = InstanceNormalization()(l111)
l113 = MaxPooling2D((3,3),strides=2,padding='same')(l112)
l110 = Add()([l090,l113])

#middleflow
l121 = Activation('relu')(l110)
l122 = SeparableConv2D(728,(3,3),padding='same')(l121)
l123 = InstanceNormalization()(l122)
l124 = Activation('relu')(l123)
l125 = SeparableConv2D(728,(3,3),padding='same')(l124)
l126 = InstanceNormalization()(l125)
l127 = Activation('relu')(l126)
l128 = SeparableConv2D(728,(3,3),padding='same')(l127)
l129 = InstanceNormalization()(l128)
l120 = Activation('relu')(l129)
l12 = Add()([l110,l120])

l131 = Activation('relu')(l12)
l132 = SeparableConv2D(728,(3,3),padding='same')(l131)
l133 = InstanceNormalization()(l132)
l134 = Activation('relu')(l133)
l135 = SeparableConv2D(728,(3,3),padding='same')(l134)
l136 = InstanceNormalization()(l135)
l137 = Activation('relu')(l136)
l138 = SeparableConv2D(728,(3,3),padding='same')(l137)
l139 = InstanceNormalization()(l138)
l130 = Activation('relu')(l139)
l13 = Add()([l12,l130])

l141 = Activation('relu')(l13)
l142 = SeparableConv2D(728,(3,3),padding='same')(l141)
l143 = InstanceNormalization()(l142)
l144 = Activation('relu')(l143)
l145 = SeparableConv2D(728,(3,3),padding='same')(l144)
l146 = InstanceNormalization()(l145)
l147 = Activation('relu')(l146)
l148 = SeparableConv2D(728,(3,3),padding='same')(l147)
l149 = InstanceNormalization()(l148)
l140 = Activation('relu')(l149)
l14 = Add()([l13,l140])

l151 = Activation('relu')(l14)
l152 = SeparableConv2D(728,(3,3),padding='same')(l151)
l153 = InstanceNormalization()(l152)
l154 = Activation('relu')(l153)
l155 = SeparableConv2D(728,(3,3),padding='same')(l154)
l156 = InstanceNormalization()(l155)
l157 = Activation('relu')(l156)
l158 = SeparableConv2D(728,(3,3),padding='same')(l157)
l159 = InstanceNormalization()(l158)
l150 = Activation('relu')(l159)
l15 = Add()([l14,l150])

l161 = Activation('relu')(l15)
l162 = SeparableConv2D(728,(3,3),padding='same')(l161)
l163 = InstanceNormalization()(l162)
l164 = Activation('relu')(l163)
l165 = SeparableConv2D(728,(3,3),padding='same')(l164)
l166 = InstanceNormalization()(l165)
l167 = Activation('relu')(l166)
l168 = SeparableConv2D(728,(3,3),padding='same')(l167)
l169 = InstanceNormalization()(l168)
l160 = Activation('relu')(l169)
l16 = Add()([l15,l160])

l171 = Activation('relu')(l16)
l172 = SeparableConv2D(728,(3,3),padding='same')(l171)
l173 = InstanceNormalization()(l172)
l174 = Activation('relu')(l173)
l175 = SeparableConv2D(728,(3,3),padding='same')(l174)
l176 = InstanceNormalization()(l175)
l177 = Activation('relu')(l176)
l178 = SeparableConv2D(728,(3,3),padding='same')(l177)
l179 = InstanceNormalization()(l178)
l170 = Activation('relu')(l179)
l17 = Add()([l16,l170])

l181 = Activation('relu')(l17)
l182 = SeparableConv2D(728,(3,3),padding='same')(l181)
l183 = InstanceNormalization()(l182)
l184 = Activation('relu')(l183)
l185 = SeparableConv2D(728,(3,3),padding='same')(l184)
l186 = InstanceNormalization()(l185)
l187 = Activation('relu')(l186)
l188 = SeparableConv2D(728,(3,3),padding='same')(l187)
l189 = InstanceNormalization()(l188)
l180 = Activation('relu')(l189)
l18 = Add()([l17,l180])

l191 = Activation('relu')(l18)
l192 = SeparableConv2D(728,(3,3),padding='same')(l191)
l193 = InstanceNormalization()(l192)
l194 = Activation('relu')(l193)
l195 = SeparableConv2D(728,(3,3),padding='same')(l194)
l196 = InstanceNormalization()(l195)
l197 = Activation('relu')(l196)
l198 = SeparableConv2D(728,(3,3),padding='same')(l197)
l199 = InstanceNormalization()(l198)
l190 = Activation('relu')(l199)
l19 = Add()([l18,l190])

#exitflow
#l201 = Conv2D(1024,(1,1), strides=2)(l19)
l201 = Conv2D(1024,(1,1),padding='same')(l17) # tolti 2 layer
l200 = InstanceNormalization()(l201)

l211 = Activation('relu')(l17) # tolti due layer
l212 = SeparableConv2D(728,(3,3),padding='same')(l211)
l213 = InstanceNormalization()(l212)
l210 = Activation('relu')(l213)

l221 = SeparableConv2D(1024,(3,3),padding='same')(l210)
l222 = InstanceNormalization()(l221)
#l223 = MaxPooling2D((3,3),strides=2,padding='same')(l222)
l220 = Add()([l200,l222])

l231 = SeparableConv2D(1536,(3,3),padding='same')(l220)
l232 = InstanceNormalization()(l231)
l230 = Activation('relu')(l232)

l241 = SeparableConv2D(2048,(3,3),padding='same')(l230)
l242 = InstanceNormalization()(l241)
l240 = Activation('relu')(l242)

#l251 = AvgPool2D((10,10))(l240)
#l252 = Dense(39)(l251)
#l250 = InstanceNormalization()(l252)

#deconvolution
#d001 = Conv2D(1024,(1,1),padding='same')(l222)
#d002 = InstanceNormalization()(d001)
#d003 = Activation('relu')(d002)
#d004 = Conv2DTranspose(1024,kernel_size=(2,2), strides=(2,2), padding='same')(l240)
#d005 = InstanceNormalization()(d004)
#d006 = Activation('relu')(d005)
#d000 = Add()([d006,d003])

d011 = Conv2D(728,(1,1),padding='same')(l112)
d012 = InstanceNormalization()(d011)
d013 = Activation('relu')(d012)
d014 = Conv2DTranspose(728,kernel_size=(2,2), strides=(2,2), padding='same')(l230) #tolto un layer
d015 = InstanceNormalization()(d014)
d016 = Activation('relu')(d015)
d010 = Concatenate()([d016,d013])

d021 = Conv2D(256,(1,1),padding='same')(l082)
d022 = InstanceNormalization()(d021)
d023 = Activation('relu')(d022)
d024 = Conv2DTranspose(256,kernel_size=(2,2), strides=(2,2), padding='same')(d010)
d025 = InstanceNormalization()(d024)
d026 = Activation('relu')(d025)
d020 = Concatenate()([d026,d023])

d031 = Conv2D(128,(1,1),padding='same')(l052)
d032 = InstanceNormalization()(d031)
d033 = Activation('relu')(d032)
d034 = Conv2DTranspose(128,kernel_size=(2,2), strides=(2,2), padding='same')(d020)
d035 = InstanceNormalization()(d034)
d036 = Activation('relu')(d035)
d030 = Concatenate()([d036,d033])


d041 = Conv2D(64,(1,1),padding='same')(l003)
d042 = InstanceNormalization()(d041)
d043 = Activation('relu')(d042)
d044 = Conv2DTranspose(64,kernel_size=(2,2), strides=(2,2), padding='same')(d030)
d045 = InstanceNormalization()(d044)
d046 = Activation('relu')(d045)
d040 = Concatenate()([d046,d043])

#l999 = Activation('softmax')(l251)
d994 = Conv2D(39,(1,1),padding='same')(d040)
d995 = InstanceNormalization()(d994)
d996 = Activation('relu')(d995)
d997 = Conv2D(39,(3,3),padding='same')(d996)
d998 = InstanceNormalization()(d997)
d999 = Activation('softmax')(d998)

model = Model(inputs=l000, outputs=d999)

########################## Xceètion Dropout

l000 = Input(shape=(img_width, img_height, 3))
l001 = Conv2D(32,(3,3),strides=1, padding='same')(l000)
l002 = InstanceNormalization()(l001)
l003 = Activation('relu')(l002)

#block1
l011 = Conv2D(32,(3,3),strides=2, padding='same')(l000)
l012 = InstanceNormalization()(l011)
l010 = Activation('relu')(l012)

l021 = Conv2D(64,(3,3),padding='same')(l010)
l022 = InstanceNormalization()(l021)
l020 = Activation('relu')(l022)

l031 = Conv2D(128,(1,1), strides=2,name='resid1')(l020)
l030 = InstanceNormalization()(l031)

#block2
l041 = SeparableConv2D(128,(3,3),padding='same',name='block2')(l020)
l042 = InstanceNormalization()(l041)
l040 = Activation('relu')(l042)

l051 = SeparableConv2D(128,(3,3),padding='same')(l040)
l052 = InstanceNormalization()(l051)
l053 = MaxPooling2D((3,3),strides=2,padding='same')(l052)
l050 = Add()([l030,l053])

l061 = Conv2D(256,(1,1), strides=2,name='resid2')(l050)
l060 = InstanceNormalization()(l061)

#block3
l071 = Activation('relu',name='block3')(l050)
l072 = SeparableConv2D(256,(3,3),padding='same')(l071)
l073 = InstanceNormalization()(l072)
l070 = Activation('relu')(l073)

l081 = SeparableConv2D(256,(3,3),padding='same')(l070)
l082 = InstanceNormalization()(l081)
l083 = MaxPooling2D((3,3),strides=2,padding='same')(l082)
l080 = Add()([l060,l083])

l091 = Conv2D(728,(1,1), strides=2,name='resid3')(l080)
l090 = InstanceNormalization()(l091)

#block4
l101 = Activation('relu',name='block4')(l080)
l102 = SeparableConv2D(728,(3,3),padding='same')(l101)
l103 = InstanceNormalization()(l102)
l100 = Activation('relu')(l103)

l111 = SeparableConv2D(728,(3,3),padding='same')(l100)
l112 = InstanceNormalization()(l111)
l113 = MaxPooling2D((3,3),strides=2,padding='same')(l112)
l110 = Add()([l090,l113])

#middleflow
l121 = Activation('relu')(l110)
l122 = SeparableConv2D(728,(3,3),padding='same')(l121)
l123 = InstanceNormalization()(l122)
l124 = Activation('relu')(l123)
l124d = Dropout(0.15)(l124)
l125 = SeparableConv2D(728,(3,3),padding='same')(l124d)
l126 = InstanceNormalization()(l125)
l127 = Activation('relu')(l126)
l127d = Dropout(0.15)(l127)
l128 = SeparableConv2D(728,(3,3),padding='same')(l127d)
l129 = InstanceNormalization()(l128)
l120 = Activation('relu')(l129)
l120d = Dropout(0.15)(l120)
l12 = Add()([l110,l120d])

l131 = Activation('relu')(l12)
l132 = SeparableConv2D(728,(3,3),padding='same')(l131)
l133 = InstanceNormalization()(l132)
l134 = Activation('relu')(l133)
l134d = Dropout(0.15)(l134)
l135 = SeparableConv2D(728,(3,3),padding='same')(l134d)
l136 = InstanceNormalization()(l135)
l137 = Activation('relu')(l136)
l137d = Dropout(0.15)(l137)
l138 = SeparableConv2D(728,(3,3),padding='same')(l137d)
l139 = InstanceNormalization()(l138)
l130 = Activation('relu')(l139)
l130d = Dropout(0.15)(l130)
l13 = Add()([l12,l130d])

l141 = Activation('relu')(l13)
l142 = SeparableConv2D(728,(3,3),padding='same')(l141)
l143 = InstanceNormalization()(l142)
l144 = Activation('relu')(l143)
l144d = Dropout(0.15)(l144)
l145 = SeparableConv2D(728,(3,3),padding='same')(l144d)
l146 = InstanceNormalization()(l145)
l147 = Activation('relu')(l146)
l147d = Dropout(0.15)(l147)
l148 = SeparableConv2D(728,(3,3),padding='same')(l147)
l149 = InstanceNormalization()(l148)
l140 = Activation('relu')(l149)
l140d = Dropout(0.15)(l140)
l14 = Add()([l13,l140d])

l151 = Activation('relu')(l14)
l152 = SeparableConv2D(728,(3,3),padding='same')(l151)
l153 = InstanceNormalization()(l152)
l154 = Activation('relu')(l153)
l154d = Dropout(0.15)(l154)
l155 = SeparableConv2D(728,(3,3),padding='same')(l154d)
l156 = InstanceNormalization()(l155)
l157 = Activation('relu')(l156)
l157d = Dropout(0.15)(l157)
l158 = SeparableConv2D(728,(3,3),padding='same')(l157d)
l159 = InstanceNormalization()(l158)
l150 = Activation('relu')(l159)
l150d = Dropout(0.15)(l150)
l15 = Add()([l14,l150d])

l161 = Activation('relu')(l15)
l162 = SeparableConv2D(728,(3,3),padding='same')(l161)
l163 = InstanceNormalization()(l162)
l164 = Activation('relu')(l163)
l164d = Dropout(0.15)(l164)
l165 = SeparableConv2D(728,(3,3),padding='same')(l164d)
l166 = InstanceNormalization()(l165)
l167 = Activation('relu')(l166)
l167d = Dropout(0.15)(l167)
l168 = SeparableConv2D(728,(3,3),padding='same')(l167d)
l169 = InstanceNormalization()(l168)
l160 = Activation('relu')(l169)
l160d = Dropout(0.15)(l160)
l16 = Add()([l15,l160d])

l171 = Activation('relu')(l16)
l172 = SeparableConv2D(728,(3,3),padding='same')(l171)
l173 = InstanceNormalization()(l172)
l174 = Activation('relu')(l173)
l174d = Dropout(0.15)(l174)
l175 = SeparableConv2D(728,(3,3),padding='same')(l174d)
l176 = InstanceNormalization()(l175)
l177 = Activation('relu')(l176)
l177d = Dropout(0.15)(l177)
l178 = SeparableConv2D(728,(3,3),padding='same')(l177d)
l179 = InstanceNormalization()(l178)
l170 = Activation('relu')(l179)
l170d = Dropout(0.15)(l170)
l17 = Add()([l16,l170d])

l181 = Activation('relu')(l17)
l182 = SeparableConv2D(728,(3,3),padding='same')(l181)
l183 = InstanceNormalization()(l182)
l184 = Activation('relu')(l183)
l185 = SeparableConv2D(728,(3,3),padding='same')(l184)
l186 = InstanceNormalization()(l185)
l187 = Activation('relu')(l186)
l188 = SeparableConv2D(728,(3,3),padding='same')(l187)
l189 = InstanceNormalization()(l188)
l180 = Activation('relu')(l189)
l18 = Add()([l17,l180])

l191 = Activation('relu')(l18)
l192 = SeparableConv2D(728,(3,3),padding='same')(l191)
l193 = InstanceNormalization()(l192)
l194 = Activation('relu')(l193)
l195 = SeparableConv2D(728,(3,3),padding='same')(l194)
l196 = InstanceNormalization()(l195)
l197 = Activation('relu')(l196)
l198 = SeparableConv2D(728,(3,3),padding='same')(l197)
l199 = InstanceNormalization()(l198)
l190 = Activation('relu')(l199)
l19 = Add()([l18,l190])

#exitflow
#l201 = Conv2D(1024,(1,1), strides=2)(l19)
l201 = Conv2D(1024,(1,1),padding='same')(l17) # tolti 2 layer
l200 = InstanceNormalization()(l201)

l211 = Activation('relu')(l17) # tolti due layer
l212 = SeparableConv2D(728,(3,3),padding='same')(l211)
l213 = InstanceNormalization()(l212)
l210 = Activation('relu')(l213)
l210d = Dropout(0.15)(l210)

l221 = SeparableConv2D(1024,(3,3),padding='same')(l210d)
l222 = InstanceNormalization()(l221)
#l223 = MaxPooling2D((3,3),strides=2,padding='same')(l222)
l220 = Add()([l200,l222])

l231 = SeparableConv2D(1536,(3,3),padding='same')(l220)
l232 = InstanceNormalization()(l231)
l230 = Activation('relu')(l232)
l230d = Dropout(0.15)(l230)


l241 = SeparableConv2D(2048,(3,3),padding='same')(l230)
l242 = InstanceNormalization()(l241)
l240 = Activation('relu')(l242)

#l251 = AvgPool2D((10,10))(l240)
#l252 = Dense(39)(l251)
#l250 = InstanceNormalization()(l252)

#deconvolution
#d001 = Conv2D(1024,(1,1),padding='same')(l222)
#d002 = InstanceNormalization()(d001)
#d003 = Activation('relu')(d002)
#d004 = Conv2DTranspose(1024,kernel_size=(2,2), strides=(2,2), padding='same')(l240)
#d005 = InstanceNormalization()(d004)
#d006 = Activation('relu')(d005)
#d000 = Add()([d006,d003])

d011 = Conv2D(728,(1,1),padding='same')(l112)
d012 = InstanceNormalization()(d011)
d013 = Activation('relu')(d012)
d013d = Dropout(0.15)(d013)
d014 = Conv2DTranspose(728,kernel_size=(2,2), strides=(2,2), padding='same')(l230d) #tolto un layer
d015 = InstanceNormalization()(d014)
d016 = Activation('relu')(d015)
d010 = Concatenate()([d016,d013d])

d021 = Conv2D(256,(1,1),padding='same')(l082)
d022 = InstanceNormalization()(d021)
d023 = Activation('relu')(d022)
d023d = Dropout(0.15)(d023)
d024 = Conv2DTranspose(256,kernel_size=(2,2), strides=(2,2), padding='same')(d010)
d025 = InstanceNormalization()(d024)
d026 = Activation('relu')(d025)
d020 = Concatenate()([d026,d023d])

d031 = Conv2D(128,(1,1),padding='same')(l052)
d032 = InstanceNormalization()(d031)
d033 = Activation('relu')(d032)
d033d = Dropout(0.15)(d033)
d034 = Conv2DTranspose(128,kernel_size=(2,2), strides=(2,2), padding='same')(d020)
d035 = InstanceNormalization()(d034)
d036 = Activation('relu')(d035)
d030 = Concatenate()([d036,d033d])

d041 = Conv2D(64,(1,1),padding='same')(l003)
d042 = InstanceNormalization()(d041)
d043 = Activation('relu')(d042)
d043d = Dropout(0.15)(d043)
d044 = Conv2DTranspose(64,kernel_size=(2,2), strides=(2,2), padding='same')(d030)
d045 = InstanceNormalization()(d044)
d046 = Activation('relu')(d045)
d040 = Concatenate()([d046,d043d])

#l999 = Activation('softmax')(l251)
d994 = Conv2D(39,(1,1),padding='same')(d040)
d995 = InstanceNormalization()(d994)
d996 = Activation('relu')(d995)
d997 = Conv2D(39,(3,3),padding='same')(d996)
d998 = InstanceNormalization()(d997)
d999 = Activation('softmax')(d998)

model = Model(inputs=l000, outputs=d999)

########################## Xp Mini

l000 = Input(shape=(img_width, img_height, 3))
l001 = Conv2D(32,(3,3),strides=1, padding='same')(l000)
l002 = InstanceNormalization()(l001)
l003 = Activation('relu')(l002)

#block1
l011 = Conv2D(32,(3,3),strides=2, padding='same')(l000)
l012 = InstanceNormalization()(l011)
l010 = Activation('relu')(l012)

l021 = Conv2D(64,(3,3),padding='same')(l010)
l022 = InstanceNormalization()(l021)
l020 = Activation('relu')(l022)

l031 = Conv2D(128,(1,1), strides=2,name='resid1')(l020)
l030 = InstanceNormalization()(l031)

#block2
l041 = SeparableConv2D(128,(3,3),padding='same',name='block2')(l020)
l042 = InstanceNormalization()(l041)
l040 = Activation('relu')(l042)

l051 = SeparableConv2D(128,(3,3),padding='same')(l040)
l052 = InstanceNormalization()(l051)
l053 = MaxPooling2D((3,3),strides=2,padding='same')(l052)
l053d = Dropout(0.15)(l053)
l050 = Add()([l030,l053d])

l061 = Conv2D(256,(1,1), strides=2,name='resid2')(l050)
l060 = InstanceNormalization()(l061)

#block3
l071 = Activation('relu',name='block3')(l050)
l072 = SeparableConv2D(256,(3,3),padding='same')(l071)
l073 = InstanceNormalization()(l072)
l070 = Activation('relu')(l073)

l081 = SeparableConv2D(256,(3,3),padding='same')(l070)
l082 = InstanceNormalization()(l081)
l083 = MaxPooling2D((3,3),strides=2,padding='same')(l082)
l083d = Dropout(0.15)(l083)
l080 = Add()([l060,l083d])

l091 = Conv2D(728,(1,1), strides=2,name='resid3')(l080)
l090 = InstanceNormalization()(l091)

#block4
l101 = Activation('relu',name='block4')(l080)
l102 = SeparableConv2D(728,(3,3),padding='same')(l101)
l103 = InstanceNormalization()(l102)
l100 = Activation('relu')(l103)

l111 = SeparableConv2D(728,(3,3),padding='same')(l100)
l112 = InstanceNormalization()(l111)
l113 = MaxPooling2D((3,3),strides=2,padding='same')(l112)
l113d = Dropout(0.15)(l113)
l110 = Add()([l090,l113d])

#middleflow
l121 = Activation('relu')(l110)
l122 = SeparableConv2D(728,(3,3),padding='same')(l121)
l123 = InstanceNormalization()(l122)
l124 = Activation('relu')(l123)
l124d = Dropout(0.15)(l124)
l125 = SeparableConv2D(728,(3,3),padding='same')(l124d)
l126 = InstanceNormalization()(l125)
l127 = Activation('relu')(l126)
l127d = Dropout(0.15)(l127)
l128 = SeparableConv2D(728,(3,3),padding='same')(l127d)
l129 = InstanceNormalization()(l128)
l120 = Activation('relu')(l129)
l120d = Dropout(0.15)(l120)
l12 = Add()([l110,l120d])

l131 = Activation('relu')(l12)
l132 = SeparableConv2D(728,(3,3),padding='same')(l131)
l133 = InstanceNormalization()(l132)
l134 = Activation('relu')(l133)
l134d = Dropout(0.15)(l134)
l135 = SeparableConv2D(728,(3,3),padding='same')(l134d)
l136 = InstanceNormalization()(l135)
l137 = Activation('relu')(l136)
l137d = Dropout(0.15)(l137)
l138 = SeparableConv2D(728,(3,3),padding='same')(l137d)
l139 = InstanceNormalization()(l138)
l130 = Activation('relu')(l139)
l130d = Dropout(0.15)(l130)
l13 = Add()([l12,l130d])

l141 = Activation('relu')(l13)
l142 = SeparableConv2D(728,(3,3),padding='same')(l141)
l143 = InstanceNormalization()(l142)
l144 = Activation('relu')(l143)
l144d = Dropout(0.15)(l144)
l145 = SeparableConv2D(728,(3,3),padding='same')(l144d)
l146 = InstanceNormalization()(l145)
l147 = Activation('relu')(l146)
l147d = Dropout(0.15)(l147)
l148 = SeparableConv2D(728,(3,3),padding='same')(l147)
l149 = InstanceNormalization()(l148)
l140 = Activation('relu')(l149)
l140d = Dropout(0.15)(l140)
l14 = Add()([l13,l140d])

l151 = Activation('relu')(l14)
l152 = SeparableConv2D(728,(3,3),padding='same')(l151)
l153 = InstanceNormalization()(l152)
l154 = Activation('relu')(l153)
l154d = Dropout(0.15)(l154)
l155 = SeparableConv2D(728,(3,3),padding='same')(l154d)
l156 = InstanceNormalization()(l155)
l157 = Activation('relu')(l156)
l157d = Dropout(0.15)(l157)
l158 = SeparableConv2D(728,(3,3),padding='same')(l157d)
l159 = InstanceNormalization()(l158)
l150 = Activation('relu')(l159)
l150d = Dropout(0.15)(l150)
l15 = Add()([l14,l150d])

l161 = Activation('relu')(l15)
l162 = SeparableConv2D(728,(3,3),padding='same')(l161)
l163 = InstanceNormalization()(l162)
l164 = Activation('relu')(l163)
l164d = Dropout(0.15)(l164)
l165 = SeparableConv2D(728,(3,3),padding='same')(l164d)
l166 = InstanceNormalization()(l165)
l167 = Activation('relu')(l166)
l167d = Dropout(0.15)(l167)
l168 = SeparableConv2D(728,(3,3),padding='same')(l167d)
l169 = InstanceNormalization()(l168)
l160 = Activation('relu')(l169)
l160d = Dropout(0.15)(l160)
l16 = Add()([l15,l160d])

l171 = Activation('relu')(l16)
l172 = SeparableConv2D(728,(3,3),padding='same')(l171)
l173 = InstanceNormalization()(l172)
l174 = Activation('relu')(l173)
l174d = Dropout(0.15)(l174)
l175 = SeparableConv2D(728,(3,3),padding='same')(l174d)
l176 = InstanceNormalization()(l175)
l177 = Activation('relu')(l176)
l177d = Dropout(0.15)(l177)
l178 = SeparableConv2D(728,(3,3),padding='same')(l177d)
l179 = InstanceNormalization()(l178)
l170 = Activation('relu')(l179)
l170d = Dropout(0.15)(l170)
l17 = Add()([l16,l170d])

l181 = Activation('relu')(l17)
l182 = SeparableConv2D(728,(3,3),padding='same')(l181)
l183 = InstanceNormalization()(l182)
l184 = Activation('relu')(l183)
l185 = SeparableConv2D(728,(3,3),padding='same')(l184)
l186 = InstanceNormalization()(l185)
l187 = Activation('relu')(l186)
l188 = SeparableConv2D(728,(3,3),padding='same')(l187)
l189 = InstanceNormalization()(l188)
l180 = Activation('relu')(l189)
l18 = Add()([l17,l180])

l191 = Activation('relu')(l18)
l192 = SeparableConv2D(728,(3,3),padding='same')(l191)
l193 = InstanceNormalization()(l192)
l194 = Activation('relu')(l193)
l195 = SeparableConv2D(728,(3,3),padding='same')(l194)
l196 = InstanceNormalization()(l195)
l197 = Activation('relu')(l196)
l198 = SeparableConv2D(728,(3,3),padding='same')(l197)
l199 = InstanceNormalization()(l198)
l190 = Activation('relu')(l199)
l19 = Add()([l18,l190])

#exitflow
#l201 = Conv2D(1024,(1,1), strides=2)(l19)
l201 = Conv2D(1024,(1,1),padding='same')(l15) # tolti 4 layer
l200 = InstanceNormalization()(l201)

l211 = Activation('relu')(l15) # tolti 4 layer
l212 = SeparableConv2D(728,(3,3),padding='same')(l211)
l213 = InstanceNormalization()(l212)
l210 = Activation('relu')(l213)
l210d = Dropout(0.15)(l210)

l221 = SeparableConv2D(1024,(3,3),padding='same')(l210d)
l222 = InstanceNormalization()(l221)
l223 = Activation('relu')(l222)
l223d = Dropout(0.15)(l223)
#l223 = MaxPooling2D((3,3),strides=2,padding='same')(l222)
l220 = Add()([l200,l223d])

l231 = SeparableConv2D(1536,(3,3),padding='same')(l220)
l232 = InstanceNormalization()(l231)
l230 = Activation('relu')(l232)
l230d = Dropout(0.15)(l230)


l241 = SeparableConv2D(2048,(3,3),padding='same')(l230)
l242 = InstanceNormalization()(l241)
l240 = Activation('relu')(l242)

#l251 = AvgPool2D((10,10))(l240)
#l252 = Dense(39)(l251)
#l250 = InstanceNormalization()(l252)

#deconvolution
#d001 = Conv2D(1024,(1,1),padding='same')(l222)
#d002 = InstanceNormalization()(d001)
#d003 = Activation('relu')(d002)
#d004 = Conv2DTranspose(1024,kernel_size=(2,2), strides=(2,2), padding='same')(l240)
#d005 = InstanceNormalization()(d004)
#d006 = Activation('relu')(d005)
#d000 = Add()([d006,d003])

d011 = Conv2D(728,(1,1),padding='same')(l112)
d012 = InstanceNormalization()(d011)
d013 = Activation('relu')(d012)
d013d = Dropout(0.15)(d013)
d014 = Conv2DTranspose(728,kernel_size=(2,2), strides=(2,2), padding='same')(l220) #tolti due layer
d015 = InstanceNormalization()(d014)
d016 = Activation('relu')(d015)
d016d = Dropout(0.15)(d016)
d010 = Add()([d016d,d013d])

d021 = Conv2D(256,(1,1),padding='same')(l082)
d022 = InstanceNormalization()(d021)
d023 = Activation('relu')(d022)
d023d = Dropout(0.15)(d023)
d024 = Conv2DTranspose(256,kernel_size=(2,2), strides=(2,2), padding='same')(d010)
d025 = InstanceNormalization()(d024)
d026 = Activation('relu')(d025)
d026d = Dropout(0.15)(d026)
d020 = Add()([d026d,d023d])

d031 = Conv2D(128,(1,1),padding='same')(l052)
d032 = InstanceNormalization()(d031)
d033 = Activation('relu')(d032)
d033d = Dropout(0.15)(d033)
d034 = Conv2DTranspose(128,kernel_size=(2,2), strides=(2,2), padding='same')(d020)
d035 = InstanceNormalization()(d034)
d036 = Activation('relu')(d035)
d036d = Dropout(0.15)(d036)
d030 = Add()([d036d,d033d])

d041 = Conv2D(64,(1,1),padding='same')(l003)
d042 = InstanceNormalization()(d041)
d043 = Activation('relu')(d042)
d043d = Dropout(0.15)(d043)
d044 = Conv2DTranspose(64,kernel_size=(2,2), strides=(2,2), padding='same')(d030)
d045 = InstanceNormalization()(d044)
d046 = Activation('relu')(d045)
d046d = Dropout(0.15)(d046)
d040 = Add()([d046d,d043d])

#l999 = Activation('softmax')(l251)
d994 = Conv2D(39,(1,1),padding='same')(d040)
d995 = InstanceNormalization()(d994)
d996 = Activation('relu')(d995)
d997 = Conv2D(39,(3,3),padding='same')(d996)
d998 = InstanceNormalization()(d997)
d999 = Activation('softmax')(d998)

model = Model(inputs=l000, outputs=d999)

